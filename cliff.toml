# cliff.toml (construire URL complÃ¨te pour commit.links)

[changelog]
body = """\
{% for group, commits_in_group in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits_in_group %}
        - {% if commit.scope %}**{{ commit.scope }}**: {% endif %}{{ commit.message | upper_first }} \
          {# Lien du commit construit manuellement #}\
          ([{{ commit.id | truncate(length=7, end="") }}]({{ remote.github.url | default(value="https://github.com") }}/{{ remote.github.owner }}/{{ remote.github.repo }}/commit/{{ commit.id }}))\
          {# Affichage des liens trouvÃ©s par link_parsers, en construisant l'URL complÃ¨te #}\
          {%- if commit.links is defined and commit.links %}\
            {% for link in commit.links %} ([{{ link.text }}]({{ remote.github.url | default(value="https://github.com") }}/{{ remote.github.owner }}/{{ remote.github.repo }}/{{ link.href }}))\
            {% endfor %}\
          {%- endif %}
    {% endfor %}
{% endfor %}\n
"""
trim = true
postprocessors = [
    # Supprime le motif original " (#dd)" (avec l'espace avant) aprÃ¨s que le link_parser l'a traitÃ©.
    { pattern = "\\s*\\(#(\\d+)\\)", replace = "" },
]

[git]
conventional_commits = true
filter_unconventional = true
sort_commits = "oldest"
commit_parsers = [
    { message = "^feat", group = "âœ¨ Features" },
    { message = "^fix", group = "ğŸ› Bug Fixes" },
    { message = "^perf", group = "âš¡ Performance Improvements" },
    { message = "^refactor", group = "â™»ï¸ Refactoring" },
    { message = "^docs", group = "ğŸ“ Documentation" },
    { message = "^style", group = "ğŸ’„ Styling" },
    { message = "^test", group = "âœ… Testing" },
    { message = "^build", group = "ğŸ“¦ Build System" },
    { message = "^ci", group = "ğŸ¤– Continuous Integration" },
    { message = "^chore", group = "ğŸ§¹ Chores" },
    { message = "^revert", group = "âª Reverts" },
]
link_parsers = [
    # pattern: trouve "(#<numÃ©ros>)"
    # href: stocke "pull/<numÃ©ros>" dans link.href (c'est relatif)
    # text: stocke "PR #<numÃ©ros>" dans link.text
    { pattern = "\\(#(\\d+)\\)", href = "pull/$1", text = "#$1"},
]


[remote.github]
owner = "clement-berard"
repo = "node-red-dxp"
url = "https://github.com" # UtilisÃ© pour construire les URLs absolues dans le template

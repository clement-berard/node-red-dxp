# cliff.toml (construire URL complète pour commit.links)

[changelog]
header = ""
footer = ""
body = """\
{% for group, commits_in_group in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits_in_group %}
        - {% if commit.scope %}**{{ commit.scope }}**: {% endif %}{{ commit.message }} \
          ([{{ commit.id | truncate(length=7, end="") }}]({{ remote.github.url | default(value="https://github.com") }}/{{ remote.github.owner }}/{{ remote.github.repo }}/commit/{{ commit.id }}))
    {%- endfor %}
{% endfor %}
"""
trim = true
#commit_preprocessors = [
#  # Transforme "#52 implement..." en "implement... (#52)"
#  { pattern = "\\(?#(\\d+)\\)?", replace = "#$1 -- toto" }
#]

[git]
conventional_commits = true
filter_commits = true
filter_unconventional = true
sort_commits = "oldest"
#commit_preprocessors = [
#    { pattern = "#(\\d+)", replace = "[#$1](https://github.com//pull/$1)" },
#    #  { pattern = "#(\\d+)", replace = "" },
#]

commit_parsers = [
    { message = "^feat", group = "<!-- 0 -->Features" },
    { message = "^(fix|Fix)", group = "<!-- 1 -->Bug Fixes" },
    { message = "^perf", group = "Performance Improvements" },
    { message = "^refactor", group = "Refactoring" },
    { message = "^(docs|doc)", group = "Documentation" },
    { message = "^style", group = "Styling" },
    { message = "^test", group = "Testing" },
    { message = "^build", group = "Build System" },
    { message = "^ci", group = "Continuous Integration" },
    { message = "^chore", group = "Chores" },
    { message = "^revert", group = "Reverts" },
]

link_parsers = [
    # Seulement au début du message
    { pattern = "#(\\d+)", href = "pull/$1", text = "#$1"},
]

#[remote.github]
#owner = "clement-berard"
#repo = "node-red-dxp"
#url = "https://github.com" # Utilisé pour construire les URLs absolues dans le template
